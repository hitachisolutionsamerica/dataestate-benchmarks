-- HISTORICAL LOAD

-- TRUNCATE TABLE
	TRUNCATE TABLE TPCDI_WH.PUBLIC.DIM_FINANCIAL;
	COMMIT;

-- LOAD TABLE
INSERT INTO TPCDI_WH.PUBLIC.DIM_FINANCIAL
SELECT
	  COALESCE(ID.SK_COMPANY_ID,NAME.SK_COMPANY_ID)
	, FINWIRE_FIN_ODS_STM.YEAR
	, FINWIRE_FIN_ODS_STM.QUARTER
	, FINWIRE_FIN_ODS_STM.QTR_START_DATE
	, FINWIRE_FIN_ODS_STM.REVENUE
	, FINWIRE_FIN_ODS_STM.EARNINGS
	, FINWIRE_FIN_ODS_STM.EPS
	, FINWIRE_FIN_ODS_STM.DILUTED_EPS
	, FINWIRE_FIN_ODS_STM.MARGIN
	, FINWIRE_FIN_ODS_STM.INVENTORY
	, FINWIRE_FIN_ODS_STM.ASSETS
	, FINWIRE_FIN_ODS_STM.LIABILITIES
	, FINWIRE_FIN_ODS_STM.SH_OUT
	, FINWIRE_FIN_ODS_STM.DILUTED_SH_OUT
	, LOCALTIMESTAMP()
FROM TPCDI_STG.PUBLIC.FINWIRE_FIN_ODS_STM
LEFT OUTER JOIN TPCDI_WH.PUBLIC.DIM_COMPANY_NOW ID ON
		IFF(LTRIM(FINWIRE_FIN_ODS_STM.CO_NAME_OR_CIK,'0')='','0',LTRIM(FINWIRE_FIN_ODS_STM.CO_NAME_OR_CIK,'0')) = ID.COMPANY_ID::STRING
LEFT OUTER JOIN TPCDI_WH.PUBLIC.DIM_COMPANY_NOW NAME ON
		FINWIRE_FIN_ODS_STM.CO_NAME_OR_CIK = NAME.NAME
WHERE FINWIRE_FIN_ODS_STM.METADATA$ACTION = 'INSERT'
;
