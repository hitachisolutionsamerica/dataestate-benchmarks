-- HISTORICAL LOAD

-- TRUNCATE TABLE
  TRUNCATE TABLE TPCDI_WH.PUBLIC.DIM_ACCOUNT;
  COMMIT;

-- RESET SEQUENCE
  CREATE OR REPLACE SEQUENCE TPCDI_WH.PUBLIC.DIM_ACCOUNT_SEQ
  START WITH = 1
  INCREMENT = 1
  COMMENT = 'DATABASE SEQUENCE TO SOURCE THE SURROGATE KEY FOR ACCOUNT.'
  ;

-- LOAD TABLE FROM NEW RECORDS
  INSERT INTO TPCDI_WH.PUBLIC.DIM_ACCOUNT
  SELECT
       TPCDI_WH.PUBLIC.DIM_ACCOUNT_SEQ.NEXTVAL --SK_ACCOUNT_ID
     , A.CUSTOMER_ACCOUNT_ID
     , DIM_BROKER.SK_BROKER_ID
     , DIM_CUSTOMER.SK_CUSTOMER_ID
     , 'ACTIVE' --STATUS
     , A.CUSTOMER_ACCOUNT_NAME
     , A.CUSTOMER_ACCOUNT_TAX_STATUS
     , TO_NUMBER(1) --IS_CURRENT
     , TO_NUMBER(1) --BATCH_ID
     , CURRENT_DATE()
     , TO_DATE('12/31/3000','MM/DD/YYYY') END_DATE
  FROM TPCDI_STG.PUBLIC.ACCOUNT_NEW_STG A
  INNER JOIN TPCDI_WH.PUBLIC.DIM_BROKER ON
      A.CUSTOMER_ACCOUNT_BROKER_ID = DIM_BROKER.BROKER_ID
  INNER JOIN TPCDI_WH.PUBLIC.DIM_CUSTOMER ON
      A.CUSTOMER_ID = DIM_CUSTOMER.CUSTOMER_ID
  ;
