-- HISTORICAL LOAD

-- TRUNCATE TABLE
  TRUNCATE TABLE TPCDI_WH.PUBLIC.FACT_CASH_BALANCES;
  COMMIT;
  
-- LOAD TABLE
  INSERT INTO TPCDI_WH.PUBLIC.FACT_CASH_BALANCES
  SELECT
       COALESCE(DIM_ACCOUNT.SK_CUSTOMER_ID,0) SK_CUSTOMER_ID
     , COALESCE(DIM_ACCOUNT.SK_ACCOUNT_ID,0) SK_ACCOUNT_ID 
     , COALESCE(DIM_DATE.DATE_ID,0) SK_DATE_ID 
     , SUM(CT_AMT) CASH
     , TO_NUMBER(1) BATCH_ID
  FROM TPCDI_STG.PUBLIC.CASHTRANSACTION_STG
LEFT JOIN TPCDI_WH.PUBLIC.DIM_ACCOUNT ON
      CASHTRANSACTION_STG.CT_CA_ID = DIM_ACCOUNT.ACCOUNT_ID
LEFT JOIN TPCDI_WH.PUBLIC.DIM_DATE ON
      TO_DATE(CASHTRANSACTION_STG.CT_DTS) = TO_DATE(DIM_DATE.DATE_VALUE)
GROUP BY 
       COALESCE(DIM_ACCOUNT.SK_CUSTOMER_ID,0)
     , COALESCE(DIM_ACCOUNT.SK_ACCOUNT_ID,0)
     , COALESCE(DIM_DATE.DATE_ID,0)
;