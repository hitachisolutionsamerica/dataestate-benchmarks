CREATE OR REPLACE PROCEDURE TPCDI_WH.PUBLIC.CUSTOMER_NEW_ODS_SP()
  returns string
  language javascript
  as
  $$
  // Process ODS Table
  var stmt = snowflake.createStatement(
      {sqlText: "INSERT INTO TPCDI_ODS.PUBLIC.CUSTOMER_ODS SELECT CNS.CUSTOMER_ID, CNS.CUSTOMER_TAX_ID, 'ACTV', CNS.LAST_NAME, CNS.FIRST_NAME, CNS.MIDDLE_INITIAL, CNS.GENDER, CNS.CUSTOMER_TIER, CNS.DATE_OF_BIRTH, CNS.ADDRESS_LINE_1, CNS.ADDRESS_LINE_2, CNS.ZIP_CODE, CNS.CITY, CNS.STATE_PROVINCE, CNS.COUNTRY, CNS.PHONE_1_COUNTRY_CODE, CNS.PHONE_1_AREA_CODE, CNS.PHONE_1_PHONE_NUMBER, CNS.PHONE_1_EXTENSION, CNS.PHONE_2_COUNTRY_CODE, CNS.PHONE_2_AREA_CODE, CNS.PHONE_2_PHONE_NUMBER, CNS.PHONE_2_EXTENSION, CNS.PHONE_3_COUNTRY_CODE, CNS.PHONE_3_AREA_CODE, CNS.PHONE_3_PHONE_NUMBER, CNS.PHONE_3_EXTENSION, CNS.PRIMARY_EMAIL, CNS.ALTERNATE_EMAIL, CNS.LOCAL_TAX_ID, CNS.NATIONAL_TAX_ID, CURRENT_TIMESTAMP() FROM TPCDI_STG.PUBLIC.CUSTOMER_NEW_STG CNS"}
    );
  stmt.execute();
  // Log audit record
  var audit_stmt = snowflake.createStatement(
      {sqlText: "INSERT INTO TPCDI_WH.PUBLIC.AUDIT SELECT 'CUSTOMER_NEW_ODS_SP', LOCALTIMESTAMP(), (SELECT MAX(BATCH_ID) FROM TPCDI_WH.PUBLIC.CTRL_BATCH), $1, 0 FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()))"}
    );
  audit_stmt.execute();
  return 'New Customer ODS records processed.';
  $$
;
