CREATE OR REPLACE VIEW TPCDI_WH.PUBLIC.DIM_CUSTOMER_NOW AS
WITH CURRENT_SK_IDS AS
(SELECT DISTINCT LAST_VALUE(SK_CUSTOMER_ID) OVER (PARTITION BY CUSTOMER_ID ORDER BY SK_CUSTOMER_ID) AS SK_CUSTOMER_ID_LAST
FROM TPCDI_WH.PUBLIC.DIM_CUSTOMER)
SELECT * FROM TPCDI_WH.PUBLIC.DIM_CUSTOMER
JOIN CURRENT_SK_IDS ON CURRENT_SK_IDS.SK_CUSTOMER_ID_LAST = DIM_CUSTOMER.SK_CUSTOMER_ID
;
