CREATE OR REPLACE VIEW TPCDI_WH.PUBLIC.DIM_FINANCIAL_ROLL_YEAR_EPS AS
SELECT
DIM_COMPANY.SK_COMPANY_ID,
DIM_COMPANY.COMPANY_ID,
DIM_FINANCIAL.FI_QTR_START_DATE,
YEAR(DIM_FINANCIAL.FI_QTR_START_DATE)::STRING || QUARTER(DIM_FINANCIAL.FI_QTR_START_DATE)::STRING AS YEAR_QTR,
DIM_FINANCIAL.FI_BASIC_EPS,
SUM(DIM_FINANCIAL.FI_BASIC_EPS) OVER (PARTITION BY DIM_FINANCIAL.SK_COMPANYID ORDER BY DIM_FINANCIAL.FI_QTR_START_DATE ROWS BETWEEN 3 PRECEDING AND CURRENT ROW) AS ROLL_YEAR_EPS
FROM TPCDI_WH.PUBLIC.DIM_FINANCIAL
INNER JOIN TPCDI_WH.PUBLIC.DIM_COMPANY ON
	DIM_FINANCIAL.SK_COMPANYID = DIM_COMPANY.SK_COMPANY_ID
;