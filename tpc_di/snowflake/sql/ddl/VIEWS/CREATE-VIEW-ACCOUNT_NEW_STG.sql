CREATE OR REPLACE VIEW TPCDI_STG.PUBLIC.ACCOUNT_NEW_STG AS
SELECT
XML:"@ActionTS"::TIMESTAMP AS ACTION_DATE
,XML:"@ActionType"::STRING AS ACTION_TYPE
,XML:"$"."@C_ID"::NUMBER AS CUSTOMER_ID
,XML:"$"."$"."@CA_ID"::NUMBER AS CUSTOMER_ACCOUNT_ID
,XML:"$"."$"."@CA_TAX_ST"::NUMBER AS CUSTOMER_ACCOUNT_TAX_STATUS
,XML:"$"."$"."$"[0]."$"::STRING AS CUSTOMER_ACCOUNT_BROKER_ID
,XML:"$"."$"."$"[1]."$"::STRING AS CUSTOMER_ACCOUNT_NAME
FROM TPCDI_STG.PUBLIC.CUSTOMER_MGMT_STG
WHERE XML:"@ActionType"::STRING = 'ADDACCT'
;
